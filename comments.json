[{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472298","pull_request_review_id":3803335095,"id":2808472298,"node_id":"PRRC_kwDORFutos6nZeLq","diff_hunk":"@@ -0,0 +1,122 @@\n+package io.memris.runtime;\n+\n+import io.memris.core.EntityMetadata;\n+import io.memris.core.EntityMetadataProvider;\n+import io.memris.core.MetadataExtractor;\n+import io.memris.core.MemrisArena;\n+import io.memris.query.CompiledQuery;\n+import io.memris.repository.MemrisRepositoryFactory;\n+import io.memris.runtime.codegen.RuntimeExecutorGenerator;\n+\n+import java.util.IdentityHashMap;\n+\n+/**\n+ * Compiles runtime artifacts once during repository creation.\n+ */\n+public final class RepositoryRuntimeCompiler {\n+\n+    private RepositoryRuntimeCompiler() {\n+    }\n+\n+    public static <T> CompiledRuntimeArtifacts compile(\n+            RepositoryPlan<T> plan,\n+            MemrisRepositoryFactory factory,\n+            MemrisArena arena,\n+            EntityMetadata<T> metadata,\n+            EntityMetadataProvider metadataProvider) {\n+        var queries = plan.queries();\n+        var queryIndexByInstance = buildQueryIndex(queries);\n+        var storageReadersByColumn = compileStorageReaders(plan);\n+        var conditionExecutorsByQuery = compileConditionExecutors(plan, metadata, factory, arena);\n+        var projectionExecutorsByQuery = compileProjectionExecutors(queries, metadataProvider);\n+        return new CompiledRuntimeArtifacts(\n+                storageReadersByColumn,\n+                conditionExecutorsByQuery,\n+                projectionExecutorsByQuery,\n+                queryIndexByInstance);\n+    }\n+\n+    private static StorageValueReader[] compileStorageReaders(RepositoryPlan<?> plan) {\n+        var table = plan.table();\n+        var typeCodes = plan.typeCodes();\n+        var columnCount = table != null\n+                ? table.columnCount()\n+                : (typeCodes != null ? typeCodes.length : 0);\n+        if (columnCount == 0) {\n+            return new StorageValueReader[0];\n+        }\n+        var readers = new StorageValueReader[columnCount];\n+        for (var i = 0; i < columnCount; i++) {\n+            var typeCode = typeCodes != null && i < typeCodes.length ? typeCodes[i] : table.typeCodeAt(i);","path":"memris-core/src/main/java/io/memris/runtime/RepositoryRuntimeCompiler.java","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"github-advanced-security[bot]","id":62310815,"node_id":"MDM6Qm90NjIzMTA4MTU=","avatar_url":"https://avatars.githubusercontent.com/in/57789?v=4","gravatar_id":"","url":"https://api.github.com/users/github-advanced-security%5Bbot%5D","html_url":"https://github.com/apps/github-advanced-security","followers_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"## Dereferenced variable may be null\n\nVariable [table](1) may be null at this access as suggested by [this](2) null guard.\n\n[Show more details](https://github.com/Thejuampi/memris/security/code-scanning/100)","created_at":"2026-02-15T03:57:34Z","updated_at":"2026-02-15T03:57:34Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808472298","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472298"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808472298"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":54,"original_line":50,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":50,"position":54,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472301","pull_request_review_id":3803335095,"id":2808472301,"node_id":"PRRC_kwDORFutos6nZeLt","diff_hunk":"@@ -0,0 +1,678 @@\n+package io.memris.runtime.codegen;\n+\n+import io.memris.core.FloatEncoding;\n+import io.memris.core.TypeCodes;\n+import io.memris.query.CompiledQuery;\n+import io.memris.query.LogicalQuery;\n+import io.memris.storage.GeneratedTable;\n+import net.bytebuddy.ByteBuddy;\n+import net.bytebuddy.dynamic.DynamicType;\n+import net.bytebuddy.implementation.MethodDelegation;\n+import net.bytebuddy.implementation.bind.annotation.RuntimeType;\n+\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Date;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+import static net.bytebuddy.matcher.ElementMatchers.named;\n+\n+/**\n+ * Generates row-level residual condition evaluators for compiled query programs.\n+ */\n+public final class ConditionRowEvaluatorGenerator {\n+\n+    private static final ConcurrentHashMap<String, RowConditionEvaluator> CACHE = new ConcurrentHashMap<>();\n+    private static final AtomicLong CLASS_COUNTER = new AtomicLong();\n+\n+    private ConditionRowEvaluatorGenerator() {\n+    }\n+\n+    @FunctionalInterface\n+    public interface RowConditionEvaluator {\n+        boolean matches(GeneratedTable table, int rowIndex, Object[] args);\n+    }\n+\n+    public static RowConditionEvaluator generate(CompiledQuery.CompiledCondition condition, boolean primitiveNonNull) {\n+        if (!isSupported(condition)) {\n+            return null;\n+        }\n+        var key = condition.columnIndex() + \":\" + condition.typeCode() + \":\" + condition.operator() + \":\"\n+                + condition.argumentIndex() + \":\" + condition.ignoreCase() + \":\" + primitiveNonNull;\n+        return CACHE.computeIfAbsent(key, ignored -> doGenerate(condition, primitiveNonNull));\n+    }\n+\n+    private static boolean isSupported(CompiledQuery.CompiledCondition condition) {\n+        var operator = condition.operator();\n+        return switch (operator) {\n+            case EQ, NE, IN, NOT_IN, IGNORE_CASE_EQ, GT, GTE, LT, LTE, BETWEEN, IS_NULL, NOT_NULL, BEFORE, AFTER -> true;\n+            default -> false;\n+        };\n+    }\n+\n+    private static RowConditionEvaluator doGenerate(CompiledQuery.CompiledCondition condition, boolean primitiveNonNull) {\n+        MatcherDelegate delegate = createDelegate(condition, primitiveNonNull);\n+        if (delegate == null) {\n+            return null;\n+        }\n+        if (!RuntimeExecutorGenerator.isEnabled()) {\n+            return delegate::matches;\n+        }\n+        try {\n+            String className = \"io.memris.runtime.codegen.RowConditionEvaluator$Gen\" + CLASS_COUNTER.incrementAndGet();\n+            DynamicType.Builder<?> builder = new ByteBuddy()\n+                    .subclass(Object.class)\n+                    .implement(RowConditionEvaluator.class)\n+                    .name(className);\n+            builder = builder.method(named(\"matches\")).intercept(MethodDelegation.to(delegate));\n+\n+            try (DynamicType.Unloaded<?> unloaded = builder.make()) {\n+                Class<?> implClass = unloaded.load(ConditionRowEvaluatorGenerator.class.getClassLoader()).getLoaded();\n+                return (RowConditionEvaluator) implClass.getDeclaredConstructor().newInstance();\n+            }\n+        } catch (Exception ignored) {\n+            return delegate::matches;\n+        }\n+    }\n+\n+    private interface MatcherDelegate {\n+        boolean matches(GeneratedTable table, int rowIndex, Object[] args);\n+    }\n+\n+    private static MatcherDelegate createDelegate(CompiledQuery.CompiledCondition condition, boolean primitiveNonNull) {\n+        var operator = normalizeOperator(condition.operator());\n+        int columnIndex = condition.columnIndex();\n+        int argumentIndex = condition.argumentIndex();\n+        byte typeCode = condition.typeCode();\n+        boolean ignoreCase = condition.ignoreCase() || condition.operator() == LogicalQuery.Operator.IGNORE_CASE_EQ;\n+\n+        if (operator == LogicalQuery.Operator.IS_NULL || operator == LogicalQuery.Operator.NOT_NULL) {\n+            return new NullMatcher(columnIndex, primitiveNonNull, operator == LogicalQuery.Operator.IS_NULL);\n+        }\n+\n+        return switch (operator) {\n+            case EQ -> createEqMatcher(columnIndex, argumentIndex, typeCode, ignoreCase, primitiveNonNull);\n+            case NE -> new InverseMatcher(createEqMatcher(columnIndex, argumentIndex, typeCode, ignoreCase, primitiveNonNull));\n+            case IN -> createInMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+            case NOT_IN -> new InverseMatcher(createInMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull));\n+            case GT, GTE, LT, LTE -> createRangeMatcher(columnIndex, argumentIndex, typeCode, operator, primitiveNonNull);\n+            case BETWEEN -> createBetweenMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+            default -> null;\n+        };\n+    }\n+\n+    private static LogicalQuery.Operator normalizeOperator(LogicalQuery.Operator operator) {\n+        return switch (operator) {\n+            case IGNORE_CASE_EQ -> LogicalQuery.Operator.EQ;\n+            case BEFORE -> LogicalQuery.Operator.LT;\n+            case AFTER -> LogicalQuery.Operator.GT;\n+            default -> operator;\n+        };\n+    }\n+\n+    private static MatcherDelegate createEqMatcher(int columnIndex,\n+            int argumentIndex,\n+            byte typeCode,\n+            boolean ignoreCase,\n+            boolean primitiveNonNull) {\n+        return switch (typeCode) {\n+            case TypeCodes.TYPE_STRING,\n+                    TypeCodes.TYPE_BIG_DECIMAL,\n+                    TypeCodes.TYPE_BIG_INTEGER -> new EqStringMatcher(columnIndex,\n+                            argumentIndex,\n+                            ignoreCase,\n+                            primitiveNonNull);\n+            case TypeCodes.TYPE_LONG,\n+                    TypeCodes.TYPE_INSTANT,\n+                    TypeCodes.TYPE_LOCAL_DATE,\n+                    TypeCodes.TYPE_LOCAL_DATE_TIME,\n+                    TypeCodes.TYPE_DATE,\n+                    TypeCodes.TYPE_DOUBLE -> new EqLongMatcher(columnIndex,\n+                            argumentIndex,\n+                            typeCode,\n+                            primitiveNonNull);\n+            default -> new EqIntMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+        };\n+    }\n+\n+    private static MatcherDelegate createRangeMatcher(int columnIndex,\n+            int argumentIndex,\n+            byte typeCode,\n+            LogicalQuery.Operator operator,\n+            boolean primitiveNonNull) {\n+        return switch (typeCode) {\n+            case TypeCodes.TYPE_LONG,\n+                    TypeCodes.TYPE_INSTANT,\n+                    TypeCodes.TYPE_LOCAL_DATE,\n+                    TypeCodes.TYPE_LOCAL_DATE_TIME,\n+                    TypeCodes.TYPE_DATE,\n+                    TypeCodes.TYPE_DOUBLE -> new RangeLongMatcher(columnIndex,\n+                            argumentIndex,\n+                            typeCode,\n+                            operator,\n+                            primitiveNonNull);\n+            default -> new RangeIntMatcher(columnIndex, argumentIndex, typeCode, operator, primitiveNonNull);\n+        };\n+    }\n+\n+    private static MatcherDelegate createBetweenMatcher(int columnIndex,\n+            int argumentIndex,\n+            byte typeCode,\n+            boolean primitiveNonNull) {\n+        return switch (typeCode) {\n+            case TypeCodes.TYPE_LONG,\n+                    TypeCodes.TYPE_INSTANT,\n+                    TypeCodes.TYPE_LOCAL_DATE,\n+                    TypeCodes.TYPE_LOCAL_DATE_TIME,\n+                    TypeCodes.TYPE_DATE,\n+                    TypeCodes.TYPE_DOUBLE -> new BetweenLongMatcher(columnIndex,\n+                            argumentIndex,\n+                            typeCode,\n+                            primitiveNonNull);\n+            default -> new BetweenIntMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+        };\n+    }\n+\n+    private static MatcherDelegate createInMatcher(int columnIndex, int argumentIndex, byte typeCode, boolean primitiveNonNull) {\n+        return switch (typeCode) {\n+            case TypeCodes.TYPE_STRING,\n+                    TypeCodes.TYPE_BIG_DECIMAL,\n+                    TypeCodes.TYPE_BIG_INTEGER -> new InStringMatcher(columnIndex, argumentIndex, primitiveNonNull);\n+            case TypeCodes.TYPE_LONG,\n+                    TypeCodes.TYPE_INSTANT,\n+                    TypeCodes.TYPE_LOCAL_DATE,\n+                    TypeCodes.TYPE_LOCAL_DATE_TIME,\n+                    TypeCodes.TYPE_DATE,\n+                    TypeCodes.TYPE_DOUBLE -> new InLongMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+            default -> new InIntMatcher(columnIndex, argumentIndex, typeCode, primitiveNonNull);\n+        };\n+    }\n+\n+    public static final class InverseMatcher implements MatcherDelegate {\n+        private final MatcherDelegate delegate;\n+\n+        private InverseMatcher(MatcherDelegate delegate) {\n+            this.delegate = delegate;\n+        }\n+\n+        @Override\n+        @RuntimeType\n+        public boolean matches(GeneratedTable table, int rowIndex, Object[] args) {\n+            if (delegate == null) {\n+                return false;\n+            }\n+            return !delegate.matches(table, rowIndex, args);\n+        }\n+    }\n+\n+    public static final class NullMatcher implements MatcherDelegate {\n+        private final int columnIndex;\n+        private final boolean primitiveNonNull;\n+        private final boolean expectNull;\n+\n+        private NullMatcher(int columnIndex, boolean primitiveNonNull, boolean expectNull) {\n+            this.columnIndex = columnIndex;\n+            this.primitiveNonNull = primitiveNonNull;\n+            this.expectNull = expectNull;\n+        }\n+\n+        @Override\n+        @RuntimeType\n+        public boolean matches(GeneratedTable table, int rowIndex, Object[] args) {\n+            if (primitiveNonNull) {\n+                return !expectNull;\n+            }\n+            boolean present = table.isPresent(columnIndex, rowIndex);\n+            return expectNull ? !present : present;\n+        }\n+    }\n+\n+    public static final class EqStringMatcher implements MatcherDelegate {\n+        private final int columnIndex;\n+        private final int argumentIndex;\n+        private final boolean ignoreCase;\n+        private final boolean primitiveNonNull;\n+\n+        private EqStringMatcher(int columnIndex, int argumentIndex, boolean ignoreCase, boolean primitiveNonNull) {\n+            this.columnIndex = columnIndex;\n+            this.argumentIndex = argumentIndex;\n+            this.ignoreCase = ignoreCase;\n+            this.primitiveNonNull = primitiveNonNull;\n+        }\n+\n+        @Override\n+        @RuntimeType\n+        public boolean matches(GeneratedTable table, int rowIndex, Object[] args) {\n+            Object argument = argAt(args, argumentIndex);\n+            String expected = argument != null ? argument.toString() : null;\n+            if (!primitiveNonNull && !table.isPresent(columnIndex, rowIndex)) {\n+                return expected == null;\n+            }\n+            String actual = table.readString(columnIndex, rowIndex);\n+            if (actual == null || expected == null) {\n+                return actual == expected;","path":"memris-core/src/main/java/io/memris/runtime/codegen/ConditionRowEvaluatorGenerator.java","commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"github-advanced-security[bot]","id":62310815,"node_id":"MDM6Qm90NjIzMTA4MTU=","avatar_url":"https://avatars.githubusercontent.com/in/57789?v=4","gravatar_id":"","url":"https://api.github.com/users/github-advanced-security%5Bbot%5D","html_url":"https://github.com/apps/github-advanced-security","followers_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"## Reference equality test on strings\n\nString values compared with  == .\n\n[Show more details](https://github.com/Thejuampi/memris/security/code-scanning/101)","created_at":"2026-02-15T03:57:34Z","updated_at":"2026-02-15T03:57:34Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808472301","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472301"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808472301"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808472301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":null,"original_line":256,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":256,"position":1,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473558","pull_request_review_id":3803335824,"id":2808473558,"node_id":"PRRC_kwDORFutos6nZefW","diff_hunk":"@@ -2128,6 +2266,52 @@ private Selection executeConditions(CompiledQuery query, Object[] args) {\n         return applyJoins(query, args, combined);\n     }\n \n+    private Selection executeCompiledConditionProgram(CompiledConditionProgram program, Object[] args) {\n+        Selection combined = null;\n+        for (var group : program.groups()) {\n+            var groupSelection = executeCompiledConditionGroup(group, args);\n+            if (groupSelection == null) {\n+                return null;\n+            }\n+            combined = combined == null ? groupSelection : combined.union(groupSelection);\n+        }\n+        return combined != null ? combined : selectionFromRows(new int[0]);\n+    }\n+\n+    private Selection executeCompiledConditionGroup(CompiledConditionGroup group, Object[] args) {\n+        var leadingSelection = group.leadSelectionExecutor().select(args);\n+        if (leadingSelection == null) {\n+            return null;\n+        }\n+\n+        var residualMatchers = group.residualMatchers();\n+        if (residualMatchers.length == 0) {\n+            return leadingSelection;\n+        }\n+\n+        var candidateRows = leadingSelection.toIntArray();\n+        var matched = new int[candidateRows.length];\n+        var matchedCount = 0;\n+\n+        for (var rowIndex : candidateRows) {\n+            var accepted = true;\n+            for (var matcher : residualMatchers) {\n+                if (!matcher.matches(plan.table(), rowIndex, args)) {\n+                    accepted = false;\n+                    break;\n+                }\n+            }","path":"memris-core/src/main/java/io/memris/runtime/RepositoryRuntime.java","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The residual matcher reads are not protected by seqlock. The matcher.matches() calls on line 2299 invoke table.readString/readLong/readInt methods directly (see ConditionRowEvaluatorGenerator matchers like EqStringMatcher line 254, EqLongMatcher line 285, etc.) without readWithSeqLock protection. This means concurrent writes could cause torn reads during condition evaluation. The matcher invocation should be wrapped: `table.readWithSeqLock(rowIndex, () -> matcher.matches(plan.table(), rowIndex, args))`","created_at":"2026-02-15T04:00:03Z","updated_at":"2026-02-15T04:00:05Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473558","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473558"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473558"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":2296,"original_start_line":2296,"start_side":"RIGHT","line":2303,"original_line":2303,"side":"RIGHT","author_association":"NONE","original_position":690,"position":690,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473559","pull_request_review_id":3803335824,"id":2808473559,"node_id":"PRRC_kwDORFutos6nZefX","diff_hunk":"@@ -0,0 +1,134 @@\n+<#\n+PowerShell script to remove non-main git worktrees for the memris repo.\n+\n+Usage examples (run from PowerShell):\n+  # Dry-run (shows actions, does not change):\n+  .\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -DryRun\n+\n+  # Interactive removal (will prompt):\n+  .\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\"\n+\n+  # Force removal and delete directories without prompts:\n+  .\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -Force\n+\n+Notes:\n+- This script ONLY runs git commands locally; it does not push or preserve unpushed commits.\n+- By default it will skip the main worktree path you specify with -Repo.\n+- Use -DryRun to preview actions before executing.\n+#>\n+[CmdletBinding()]\n+param(\n+    [string]\n+    $Repo = \".\",\n+\n+    [switch]\n+    $Force,\n+\n+    [switch]\n+    $DryRun\n+)\n+\n+function FailIfNoGit {\n+    if (-not (Get-Command git -ErrorAction SilentlyContinue)) {\n+        Write-Error \"git is not available in PATH. Install git and try again.\"\n+        exit 2\n+    }\n+}\n+\n+function Run-Git {\n+    param($Args)\n+    $cmd = \"git -C `\"$Repo`\" $Args\"\n+    if ($DryRun) { Write-Host \"DRYRUN: $cmd\"; return $null }\n+    & git -C \"$Repo\" $Args\n+}\n+\n+FailIfNoGit\n+\n+$repoFull = (Resolve-Path -Path $Repo).ProviderPath\n+Write-Host \"Repository root: $repoFull\"\n+\n+# Get worktree list in porcelain format\n+$porcelain = & git -C \"$Repo\" worktree list --porcelain 2>&1\n+if ($LASTEXITCODE -ne 0) {\n+    Write-Error \"Failed to run 'git worktree list'. Output:`n$porcelain\"\n+    exit 3\n+}\n+\n+# Parse porcelain blocks (blocks separated by blank line)\n+$blocks = -split ($porcelain -join \"`n\"), \"`n`n\"","path":"scripts/remove_memris_worktrees.ps1","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The -split operator syntax appears incorrect. The correct PowerShell syntax for splitting on a delimiter should be: `$blocks = ($porcelain -join \"`n\") -split \"`n`n\"`. The current syntax `-split ($porcelain -join \"`n\"), \"`n`n\"` uses the unary -split operator with a comma, which will not work as intended.\n```suggestion\n$blocks = ($porcelain -join \"`n\") -split \"`n`n\"\n```","created_at":"2026-02-15T04:00:03Z","updated_at":"2026-02-15T04:00:05Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473559","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473559"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473559"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473559/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":58,"original_line":58,"side":"RIGHT","author_association":"NONE","original_position":58,"position":58,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473561","pull_request_review_id":3803335824,"id":2808473561,"node_id":"PRRC_kwDORFutos6nZefZ","diff_hunk":"@@ -0,0 +1,29 @@\n+Worktree cleanup script\n+\n+This repository includes `scripts/remove_memris_worktrees.ps1` â€” a PowerShell helper to remove non-main git worktrees.\n+\n+Default behavior:\n+- Discovers all worktrees for the repository you specify with `-Repo` (default `.`).\n+- Preserves the main worktree and removes all other worktrees.\n+- Prompts for confirmation unless you pass `-Force`.\n+- Offers a dry-run mode with `-DryRun` to preview actions.\n+\n+Example usage (from PowerShell):\n+\n+```powershell\n+# Preview actions only\n+.\n+\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -DryRun\n+\n+# Interactive run (prompts before removing and deleting directories)\n+.\n+\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\"\n+\n+# Force removal and delete directories without prompts\n+.\n+\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -Force","path":"scripts/README-worktree-cleanup.md","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"Markdown formatting issue: the example commands are split across multiple lines. The period and backslash should be together on one line. For example, line 15-16 should be: `.\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -DryRun`. The current formatting breaks the code block into invalid PowerShell syntax.\n```suggestion\n.\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -DryRun\n\n# Interactive run (prompts before removing and deleting directories)\n.\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\"\n\n# Force removal and delete directories without prompts\n.\\scripts\\remove_memris_worktrees.ps1 -Repo \"G:\\dev\\repos\\memris\" -Force\n```","created_at":"2026-02-15T04:00:03Z","updated_at":"2026-02-15T04:00:06Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473561","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473561"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473561"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":15,"original_start_line":15,"start_side":"RIGHT","line":24,"original_line":24,"side":"RIGHT","author_association":"NONE","original_position":24,"position":24,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473564","pull_request_review_id":3803335824,"id":2808473564,"node_id":"PRRC_kwDORFutos6nZefc","diff_hunk":"@@ -139,7 +135,7 @@ private static FieldValueReader doGenerateFieldValueReader(int columnIndex, byte\n                 return (FieldValueReader) implClass.getDeclaredConstructor().newInstance();\n             }\n         } catch (Exception e) {\n-            return createFallbackFieldValueReader(columnIndex, typeCode, converter);\n+            throw new IllegalStateException(\"Failed to generate FieldValueReader for column \" + columnIndex, e);\n         }","path":"memris-core/src/main/java/io/memris/runtime/codegen/RuntimeExecutorGenerator.java","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"3c30094f1744859ceafbce43668aa3ad5aa0cfa3","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"Behavior change: removed fallback to non-codegen implementation on generation failure. Previously, if bytecode generation failed, the code would gracefully fall back to createFallbackFieldValueReader. Now it throws IllegalStateException, which will crash the application. This makes the system less resilient to bytecode generation failures (e.g., due to classloader issues, security managers, or ByteBuddy bugs). Consider whether this trade-off (fail-fast vs. graceful degradation) is acceptable for production use.","created_at":"2026-02-15T04:00:04Z","updated_at":"2026-02-15T04:00:04Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473564","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473564"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808473564"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808473564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":137,"original_start_line":137,"start_side":"RIGHT","line":139,"original_line":139,"side":"RIGHT","author_association":"NONE","original_position":17,"position":17,"subject_type":"line"},{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808475286","pull_request_review_id":3803337051,"id":2808475286,"node_id":"PRRC_kwDORFutos6nZe6W","diff_hunk":"@@ -0,0 +1,126 @@\n+package io.memris.runtime;\n+\n+import io.memris.core.EntityMetadata;\n+import io.memris.core.EntityMetadataProvider;\n+import io.memris.core.MetadataExtractor;\n+import io.memris.core.MemrisArena;\n+import io.memris.query.CompiledQuery;\n+import io.memris.repository.MemrisRepositoryFactory;\n+import io.memris.runtime.codegen.RuntimeExecutorGenerator;\n+\n+import java.util.IdentityHashMap;\n+\n+/**\n+ * Compiles runtime artifacts once during repository creation.\n+ */\n+public final class RepositoryRuntimeCompiler {\n+\n+    private RepositoryRuntimeCompiler() {\n+    }\n+\n+    public static <T> CompiledRuntimeArtifacts compile(\n+            RepositoryPlan<T> plan,\n+            MemrisRepositoryFactory factory,\n+            MemrisArena arena,\n+            EntityMetadata<T> metadata,\n+            EntityMetadataProvider metadataProvider) {\n+        var queries = plan.queries();\n+        var queryIndexByInstance = buildQueryIndex(queries);\n+        var storageReadersByColumn = compileStorageReaders(plan);\n+        var conditionExecutorsByQuery = compileConditionExecutors(plan, metadata, factory, arena);\n+        var projectionExecutorsByQuery = compileProjectionExecutors(queries, metadataProvider);\n+        return new CompiledRuntimeArtifacts(\n+                storageReadersByColumn,\n+                conditionExecutorsByQuery,\n+                projectionExecutorsByQuery,\n+                queryIndexByInstance);\n+    }\n+\n+    private static StorageValueReader[] compileStorageReaders(RepositoryPlan<?> plan) {\n+        var table = plan.table();\n+        var typeCodes = plan.typeCodes();\n+        var columnCount = table != null ? table.columnCount() : (typeCodes != null ? typeCodes.length : 0);\n+        if (columnCount == 0) {\n+            return new StorageValueReader[0];\n+        }\n+        var readers = new StorageValueReader[columnCount];\n+        if (table == null) {\n+            for (var i = 0; i < columnCount; i++) {\n+                readers[i] = RuntimeExecutorGenerator.generateStorageValueReader(i, typeCodes[i]);","path":"memris-core/src/main/java/io/memris/runtime/RepositoryRuntimeCompiler.java","commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","original_commit_id":"d1af33573a367afffbb861ca7a0b3b1ee47aa04c","user":{"login":"github-advanced-security[bot]","id":62310815,"node_id":"MDM6Qm90NjIzMTA4MTU=","avatar_url":"https://avatars.githubusercontent.com/in/57789?v=4","gravatar_id":"","url":"https://api.github.com/users/github-advanced-security%5Bbot%5D","html_url":"https://github.com/apps/github-advanced-security","followers_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-advanced-security%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"## Dereferenced variable may be null\n\nVariable [typeCodes](1) may be null at this access as suggested by [this](2) null guard.\nVariable [typeCodes](1) may be null at this access as suggested by [this](3) null guard.\n\n[Show more details](https://github.com/Thejuampi/memris/security/code-scanning/102)","created_at":"2026-02-15T04:04:00Z","updated_at":"2026-02-15T04:04:01Z","html_url":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808475286","pull_request_url":"https://api.github.com/repos/Thejuampi/memris/pulls/39","_links":{"self":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808475286"},"html":{"href":"https://github.com/Thejuampi/memris/pull/39#discussion_r2808475286"},"pull_request":{"href":"https://api.github.com/repos/Thejuampi/memris/pulls/39"}},"reactions":{"url":"https://api.github.com/repos/Thejuampi/memris/pulls/comments/2808475286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":49,"original_line":49,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":49,"position":49,"subject_type":"line"}]