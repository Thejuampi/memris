<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="Memris Rules"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>
        PMD rules for Memris project - Heap-based in-memory storage engine
    </description>

    <!-- Best Practices -->
    <rule ref="category/java/bestpractices.xml">
        <exclude name="GuardLogStatement" /><!-- Not using logging in this project -->
        <exclude name="UnusedPrivateMethod" /><!-- Methods may be used via reflection -->
        <exclude name="UnusedPrivateField" /><!-- Fields may be accessed via MethodHandles -->
    </rule>

    <!-- Code Style -->
    <rule ref="category/java/codestyle.xml">
        <exclude name="AtLeastOneConstructor" /><!-- Records don't need explicit constructors -->
        <exclude name="CallSuperInConstructor" /><!-- Not always needed -->
        <exclude name="CommentDefaultAccessModifier" /><!-- Package-private is intentional -->
        <exclude name="DefaultPackage" /><!-- Allow default package in tests -->
        <exclude name="EmptyControlStatement" /><!-- Sometimes intentional for clarity -->
        <exclude name="LongVariable" /><!-- Long descriptive names are good -->
        <exclude name="OnlyOneReturn" /><!-- Early returns are preferred -->
        <exclude name="ShortClassName" /><!-- Short names like EQ, GT are intentional -->
        <exclude name="ShortMethodName" /><!-- Short names like gt(), lt() are intentional -->
        <exclude name="ShortVariable" /><!-- Short names like i, j in loops are fine -->
        <exclude name="UseUnderscoresInNumericLiterals" /><!-- 1024 vs 1_024 - either is fine -->
    </rule>

    <!-- Import Management -->
    <rule ref="category/java/codestyle.xml/UnnecessaryImport" />

    <!-- Design -->
    <rule ref="category/java/design.xml">
        <exclude name="AvoidCatchingGenericException" /><!-- Sometimes necessary -->
        <exclude name="AvoidThrowingRawExceptionTypes" /><!-- IllegalArgumentException is fine -->
        <exclude name="CouplingBetweenObjects" /><!-- High coupling is acceptable in this design -->
        <exclude name="CyclomaticComplexity" /><!-- Complex switch statements are OK -->
        <exclude name="DataClass" /><!-- Records are intentionally data classes -->
        <exclude name="ExcessiveClassLength" /><!-- Large files are OK if focused -->
        <exclude name="ExcessiveMethodLength" /><!-- Long methods with switch statements OK -->
        <exclude name="ExcessiveParameterList" /><!-- Sometimes needed for completeness -->
        <exclude name="ExcessivePublicCount" /><!-- Public API classes need many methods -->
        <exclude name="LawOfDemeter" /><!-- Chain calls are common in builders -->
        <exclude name="NcssCount" /><!-- Not a good metric for this codebase -->
        <exclude name="NPathComplexity" /><!-- Switch statements increase this metric -->
        <exclude name="SimplifiedTernary" /><!-- Explicit ternary can be clearer -->
        <exclude name="TooManyFields" /><!-- Tables have many columns/fields -->
        <exclude name="TooManyMethods" /><!-- Public API classes need many methods -->
        <exclude name="UseObjectForClearerAPI" /><!-- Primitive parameters are intentional -->
        <exclude name="UseUtilityClass" /><!-- Some classes are meant to be instantiated -->
    </rule>

    <!-- Documentation -->
    <rule ref="category/java/documentation.xml">
        <exclude name="CommentRequired" /><!-- Not all members need comments -->
        <exclude name="CommentSize" /><!-- Long comments are sometimes necessary -->
    </rule>

    <!-- Error Prone -->
    <rule ref="category/java/errorprone.xml">
        <exclude name="AvoidFieldNameMatchingMethodName" /><!-- Common in this codebase -->
        <exclude name="AvoidFieldNameMatchingTypeName" /><!-- Common in this codebase -->
        <exclude name="BeanMembersShouldSerialize" /><!-- Not a bean-based project -->
        <exclude name="CompareObjectsWithEquals" /><!-- Sometimes intentional for identity -->
        <exclude name="ConstructorCallsOverridableMethod" /><!-- Not an issue with final classes -->
        <exclude name="DataflowAnomalyAnalysis" /><!-- Many false positives -->
        <exclude name="DoNotTerminateVM" /><!-- System.exit() is sometimes needed -->
        <exclude name="EmptyIfStmt" /><!-- Sometimes intentional -->
        <exclude name="MissingSerialVersionUID" /><!-- Not using serialization -->
        <exclude name="NullAssignment" /><!-- Sometimes necessary for initialization -->
        <exclude name="ReturnEmptyCollectionRatherThanNull" /><!-- Null has semantic meaning sometimes -->
        <exclude name="UseProperClassLoader" />><!-- Not applicable -->
    </rule>

    <!-- Multithreading -->
    <rule ref="category/java/multithreading.xml">
        <exclude name="AvoidSynchronizedAtMethodLevel" /><!-- Sometimes necessary -->
        <exclude name="DoNotUseThreads" /><!-- Thread pools are used -->
        <exclude name="UseConcurrentHashMap" /><!-- Sometimes HashMap is sufficient -->
    </rule>

    <!-- Performance -->
    <rule ref="category/java/performance.xml">
        <exclude name="AvoidInstantiatingObjectsInLoops" /><!-- Sometimes necessary -->
        <exclude name="InsufficientStringBufferDeclaration" /><!-- Premature optimization -->
        <exclude name="RedundantFieldInitializer" /><!-- Explicit initialization is clearer -->
        <exclude name="TooFewBranchesForASwitchStatement" /><!-- Even 2 cases is fine for switch -->
    </rule>

    <!-- Security -->
    <rule ref="category/java/security.xml" />

</ruleset>
