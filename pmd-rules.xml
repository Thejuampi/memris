<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="Memris Rules"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>
        PMD rules for Memris project - Heap-based in-memory storage engine
    </description>

    <!-- Best Practices -->
    <rule ref="category/java/bestpractices.xml">
        <exclude name="GuardLogStatement" /><!-- Not using logging in this project -->
        <exclude name="UnusedPrivateMethod" /><!-- Methods may be used via reflection -->
        <exclude name="UnusedPrivateField" /><!-- Fields may be accessed via MethodHandles -->
    </rule>

    <!-- Code Style -->
    <rule ref="category/java/codestyle.xml">
        <exclude name="AtLeastOneConstructor" /><!-- Records don't need explicit constructors -->
        <exclude name="AvoidDuplicateLiterals" /><!-- Error messages intentionally repeated -->
        <exclude name="CallSuperInConstructor" /><!-- Not always needed -->
        <exclude name="CommentDefaultAccessModifier" /><!-- Package-private is intentional -->
        <exclude name="ControlStatementBraces" /><!-- Concise style for lock-free code -->
        <exclude name="EmptyControlStatement" /><!-- Sometimes intentional for clarity -->
        <exclude name="ForLoopCanBeForeach" /><!-- Indexed loops needed for position -->
        <exclude name="ImplicitFunctionalInterface" /><!-- Added @FunctionalInterface annotations -->
        <exclude name="LongVariable" /><!-- Long descriptive names are good -->
        <exclude name="LinguisticNaming" /><!-- Sometimes intentional for clarity -->
        <exclude name="OnlyOneReturn" /><!-- Early returns are preferred -->
        <exclude name="ShortClassName" /><!-- Short names like EQ, GT are intentional -->
        <exclude name="ShortMethodName" /><!-- Short names like gt(), lt() are intentional -->
        <exclude name="ShortVariable" /><!-- Short names like i, j in loops are fine -->
        <exclude name="UnnecessaryCaseChange" /><!-- Case conversion sometimes intentional -->
        <exclude name="UnnecessaryImport" /><!-- Checkstyle already handles this -->
        <exclude name="UseExplicitTypes" /><!-- Project prefers var for locals -->
        <exclude name="UseLocaleWithCaseConversions" /><!-- Locale sometimes not needed -->
        <exclude name="UseUnderscoresInNumericLiterals" /><!-- 1024 vs 1_024 - either is fine -->
        <exclude name="UseVarargs" /><!-- Array parameter sometimes intentional -->
        <exclude name="MethodArgumentCouldBeFinal" /><!-- Not adding final keywords per user request -->
        <exclude name="LocalVariableCouldBeFinal" /><!-- Not adding final keywords per user request -->
    </rule>

    <!-- Design -->
    <rule ref="category/java/design.xml">
        <exclude name="AvoidCatchingGenericException" /><!-- Sometimes necessary -->
        <exclude name="AvoidThrowingRawExceptionTypes" /><!-- IllegalArgumentException is fine -->
        <exclude name="CognitiveComplexity" /><!-- Complex query parsing and method resolution necessary -->
        <exclude name="CouplingBetweenObjects" /><!-- High coupling is acceptable in this design -->
        <exclude name="CyclomaticComplexity" /><!-- Complex switch statements are OK -->
        <exclude name="DataClass" /><!-- Records are intentionally data classes -->
        <exclude name="ExcessiveParameterList" /><!-- Sometimes needed for completeness -->
        <exclude name="ExcessivePublicCount" /><!-- Public API classes need many methods -->
        <exclude name="GodClass" /><!-- Build-time components justified -->
        <exclude name="LawOfDemeter" /><!-- Chain calls are common in builders -->
        <exclude name="LooseCoupling" /><!-- Concrete types chosen for performance -->
        <exclude name="NcssCount" /><!-- Not a good metric for this codebase -->
        <exclude name="NPathComplexity" /><!-- Switch statements increase this metric -->
        <exclude name="SimplifiedTernary" /><!-- Explicit ternary can be clearer -->
        <exclude name="TooManyFields" /><!-- Tables have many columns/fields -->
        <exclude name="TooManyMethods" /><!-- Public API classes need many methods -->
        <exclude name="UseObjectForClearerAPI" /><!-- Primitive parameters are intentional -->
        <exclude name="UseUtilityClass" /><!-- Some classes are meant to be instantiated -->
    </rule>

    <!-- Documentation -->
    <rule ref="category/java/documentation.xml">
        <exclude name="CommentRequired" /><!-- Not all members need comments -->
        <exclude name="CommentSize" /><!-- Long comments are sometimes necessary -->
        <exclude name="DanglingJavadoc" /><!-- Valid record component Javadoc in CompiledQuery -->
    </rule>

    <!-- Error Prone -->
    <rule ref="category/java/errorprone.xml">
        <exclude name="AssignmentInOperand" /><!-- Intentional for performance-critical paths -->
        <exclude name="AvoidAccessibilityAlteration" /><!-- Required for reflection in generated code -->
        <exclude name="AvoidFieldNameMatchingMethodName" /><!-- Common in this codebase -->
        <exclude name="AvoidFieldNameMatchingTypeName" /><!-- Common in this codebase -->
        <exclude name="AvoidLiteralsInIfCondition" /><!-- Literals (0L, 1, etc.) are intentional -->
        <exclude name="AvoidUsingVolatile" /><!-- Required for lock-free concurrent access -->
        <exclude name="CompareObjectsWithEquals" /><!-- Sometimes intentional for identity -->
        <exclude name="ConstructorCallsOverridableMethod" /><!-- Not an issue with final classes -->
        <exclude name="DoNotTerminateVM" /><!-- System.exit() is sometimes needed -->
        <exclude name="MissingSerialVersionUID" /><!-- Not using serialization -->
        <exclude name="NullAssignment" /><!-- Sometimes necessary for initialization -->
        <exclude name="ReturnEmptyCollectionRatherThanNull" /><!-- Null has semantic meaning sometimes -->
        <exclude name="SimplifyBooleanReturns" /><!-- False positives on boolean expressions -->
        <exclude name="SignatureDeclareThrowsException" /><!-- Required for generated interceptors -->
        <exclude name="UnnecessaryBoxing" /><!-- Sometimes intentional for type safety -->
        <exclude name="UnnecessaryCast" /><!-- Sometimes intentional for type safety -->
        <exclude name="UseProperClassLoader" /><!-- Not applicable -->
    </rule>

    <!-- Multithreading -->
    <rule ref="category/java/multithreading.xml">
        <exclude name="AvoidSynchronizedAtMethodLevel" /><!-- Sometimes necessary -->
        <exclude name="DoNotUseThreads" /><!-- Thread pools are used -->
        <exclude name="UseConcurrentHashMap" /><!-- Sometimes HashMap is sufficient -->
    </rule>

    <!-- Performance -->
    <rule ref="category/java/performance.xml">
        <exclude name="AvoidInstantiatingObjectsInLoops" /><!-- Sometimes necessary -->
        <exclude name="InsufficientStringBufferDeclaration" /><!-- Premature optimization -->
        <exclude name="RedundantFieldInitializer" /><!-- Explicit initialization is clearer -->
    </rule>

    <!-- Security -->
    <rule ref="category/java/security.xml" />

</ruleset>
